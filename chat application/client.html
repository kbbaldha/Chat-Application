<!DOCTYPE html>
<html>
    <head>
        <script  src="/socket.io/socket.io.js"></script>
		
        <script type="text/javascript">
            var socketio = io.connect("192.168.9.36:8889");
			socketio.on("message_to_client", function(data) {
			document.getElementById("chatlog").innerHTML = ("<hr/>" +
			data['message'] + document.getElementById("chatlog").innerHTML);
			});
			
			function sendMessage() {
				var name = document.getElementById("name_input").value;
				var msg = name + " : "+ document.getElementById("message_input").value;
				
				socketio.emit("message_to_server", { message : msg});
			}

			function getUserName() {
			    var xmlhttp = new XMLHttpRequest();
			    xmlhttp.open("GET", "http://localhost:8881/getUser", true);
			    xmlhttp.onreadystatechange = function () {
			        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
			            var string = xmlhttp.responseText;
			            console.log('the user is' + string);
			            setUser(string);
			        }
			    }
			    xmlhttp.send();
			}

			function setUser(name) {
			    document.getElementById('user').innerHTML = 'welcome ' + name;
			}
        </script>
    </head>
    <body onload="getUserName()">
		<div id="user"></div> 
        <input type="text" id="message_input"/>
        <button onclick="sendMessage()">send</button>
        <div id="chatlog"></div>
    </body>
</html>